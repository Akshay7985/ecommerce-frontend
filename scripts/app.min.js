console.log("E-Commerce Website Loaded");


// âœ… Update cart badge dynamically on all pages
function updateCartBadge() {
  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
  const cartBadge = document.querySelector(".cart-badge");
  if (cartBadge) cartBadge.textContent = totalItems;
}

// Call it immediately when page loads
updateCartBadge();


// ========== Navigation Menu ==========
const hamburger = document.querySelector(".hamburger");
const navLinks = document.querySelector(".nav-links");

if (hamburger && navLinks) {
  hamburger.addEventListener("click", () => {
    navLinks.classList.toggle("active");
  });
}

// ========== Smooth Scroll ==========
const ctaButton = document.querySelector(".cta-btn");
if (ctaButton) {
  ctaButton.addEventListener("click", () => {
    window.scrollTo({
      top: 700,
      behavior: "smooth",
    });
  });
}

// ========== Product Loading ==========
document.addEventListener("DOMContentLoaded", () => {
  const productGrid = document.getElementById("product-grid");

  if (!productGrid) {
    console.error("Product grid element not found!");
    return;
  }

  productGrid.innerHTML = "<p>Loading products...</p>";

  function displayProducts(products) {
    productGrid.innerHTML = ""; // Clear loading text

    products.forEach((product) => {
      const card = document.createElement("div");
      card.classList.add("product-card");

      // Redirect when product is clicked
      card.addEventListener("click", () => {
        window.location.href = `product.html?id=${product.id}`;
      });

      card.innerHTML = `
        <img loading="lazy" src="${product.image}" alt="${product.title}">
        <div class="product-info">
          <h3>${product.title.slice(0, 40)}...</h3>
          <p>$${product.price.toFixed(2)}</p>
          <button>Add to Cart</button>
        </div>
      `;

      productGrid.appendChild(card);
    });
  }

  const cachedProducts = localStorage.getItem("products");

  if (cachedProducts) {
    console.log("Loaded products from localStorage");
    displayProducts(JSON.parse(cachedProducts));
  } else {
    console.log("Fetching products from API...");
    fetch("https://fakestoreapi.com/products")
      .then((res) => {
        if (!res.ok) throw new Error("Network response was not ok");
        return res.json();
      })
      .then((products) => {
        displayProducts(products);
        localStorage.setItem("products", JSON.stringify(products));
      })
      .catch((error) => {
        console.error("Error fetching products:", error);
        productGrid.innerHTML =
          "<p style='color:red;'>Failed to load products. Please try again later.</p>";
      });
  }
});
